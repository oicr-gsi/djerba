---
title: "extract_plots.R"
author: "Lauren Toy Dec 2022"
output: html_document
---  
***
#### **Packages**
```{r}
library(ggplot2)
library(data.table)
library(forcats) # within tidyverse
```  
***
#### **Callability vs Coverage**
* scatter plot w/ trendline
* input csv w/ Callability (%) and Coverage (mean) for each sample
* this csv is output of a multi query (design.py & pull.py)
```{r message=FALSE, fig.align="center", fig.dim = c(8,4)}
callvcov_file = '/home/ltoy/Desktop/couch/extract/graph/compare_Callability (%)&Coverage (mean).csv'
callvcov <- fread(callvcov_file, header=TRUE)
callability = callvcov$`Callability (%)`
coverage = callvcov$`Coverage (mean)`
ggplot(callvcov, aes(x=coverage, y=callability)) +
  geom_point(size=2, shape=18) +
  labs(x="Coverage (mean)", y="Callability (%)") +
  scale_x_continuous(breaks=c(50,75,100,125,150), limits=c(40,155), expand=c(0,0))+
  geom_smooth()
```  

***
#### **Small Mutations and Indels**
* bar graph
* input csv w/ the genes and corresponding mutation type for each sample 
* this csv is output of additional step (process.py) after multi query (design.py & pull.py)
```{r}
small_file = '/home/ltoy/Desktop/couch/extract/graph/small_Study&Body&Tumour Mutation Burden_processed.csv'
small <- fread(small_file, header=TRUE)
s <-
  ggplot(small)+
  geom_bar(aes(x=fct_infreq(small$Gene), fill=small$Type)) +
  labs(title = "Small Mutations and Indels", y="Mutation Count", fill="Mutation Type") + 
  theme_classic() +
  theme(
    plot.title = element_text(hjust=0.5),
    axis.title.x=element_blank(),
    axis.title.y=element_text(size=10, vjust=2.25),
    axis.line.x=element_blank(), axis.line.y=element_blank(),
    axis.ticks.x=element_blank(),axis.ticks.y=element_blank(),
    axis.text.x=element_text(angle=90, face="italic", hjust=1, margin=margin(t=-4))
    )
```

```{r fig.align="center", fig.dim=c(9,3)}
s
```

```{r fig.align="center", fig.dim=c(10,3.5)}
s + facet_grid(.~Study, scales="free_x", space="free_x") # subset by Study in x dir
```  

```{r fig.align="center", fig.dim=c(13,4)}
s + facet_wrap(~Study, scales='free', ncol=3) 
```  

***
#### **Oncogenic Somatic CNVs**
* bar graph
* input csv w/ the genes and corresponding mutation type for each sample 
* this csv is output of additional step (process.py) after multi query (design.py & pull.py)
```{r}
onco_file = '/home/ltoy/Desktop/couch/extract/graph/onco_Study&Body&Tumour Mutation Burden_processed.csv'
onco <- fread(onco_file, header=TRUE)
o <-
ggplot(onco)+
  geom_bar(aes(x=fct_infreq(onco$Gene), fill=onco$Alteration)) +
  labs(title = "Oncogenic Somatic CNVs", y="Mutation Count", fill="Alteration Type") + 
  theme_classic() +
  theme(
    plot.title = element_text(hjust=0.5),
    axis.title.x=element_blank(),
    axis.title.y=element_text(size=10, vjust=2.25),
    axis.line.x=element_blank(), axis.line.y=element_blank(),
    axis.ticks.x=element_blank(),axis.ticks.y=element_blank(),
    axis.text.x=element_text(angle=90, face="italic", hjust=1, margin=margin(t=-3))
  ) 
```  

```{r fig.align="center", fig.dim=c(20,4)}
o
```

```{r fig.align="center", fig.dim=c(25,4)}
o + facet_grid(.~Study, scales="free_x", space="free_x") # subset by Study in x dir
```

```{r fig.align="center", fig.dim=c(25,8)}
o + facet_wrap(~Study, scales='free', ncol=2) 
```