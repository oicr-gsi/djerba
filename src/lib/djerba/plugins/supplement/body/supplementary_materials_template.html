<%
  from djerba.util.html import html_builder
  from time import strftime
  import djerba.core.constants as core_constants
  import djerba.plugins.supplement.body.versioning as versions
  from djerba.plugins.supplement.body.plugin import main as supplement
  ASSAY = results.get(supplement.ASSAY)
  FAILED = results.get(supplement.FAILED)
%>


<br/>
<br/>
<br/>
<br/>
<br/>
<br/>

<hr class="big-line" style="width: 100%; "  >

${html_builder().section_cells_begin("<h2>Assay description</h2>",True, no_hr_after=True)}

% if ASSAY in ['WGTS', 'WGTS40X']:
  <p> This assay combines two comprehensive next generation sequencing assays: a DNA-based whole genome sequencing (WGS) assay and an RNA-based whole transcriptome sequencing (WTS) assay.</p>
  <%include file="resources/WGS.description.versions.html"/>
  <%include file="resources/WTS.description.versions.html"/>
% elif ASSAY in ['WGS', 'WGS40X']:
  <p>This assay is a comprehensive next generation sequencing assay, specifically DNA-based whole genome sequencing (WGS). </p>
  <%include file="resources/WGS.description.versions.html"/>
% elif ASSAY == 'TAR':
  <%include file="resources/TAR.description.versions.html"/>
% elif ASSAY == 'PWGS':
  <%include file="resources/PWGS.description.versions.html"/>
% endif

## !!! IMPORTANT !!! If this text is modified, update redact_html in util.testing.tools
<p>Assay results were collated into the report document by <a href=${versions.DJERBA_LINK}>Djerba</a> (${versions.DJERBA_VERSION}) using pipeline ${versions.PIPELINE_VERSION}.</p>

${html_builder().section_cells_end()}

% if ASSAY == 'TAR' :

    ${html_builder().section_cells_begin("<h2>Target Group Information</h2>",True)}
      <%include file="resources/TAR.genes.html"/>
    ${html_builder().section_cells_end()}

  % endif

  ${html_builder().section_cells_begin("<h2>Disclaimer</h2>",True)}

% if ASSAY in ('WGTS','WGS'):
  <%include file="resources/WGS.disclaimer.html"/>
% elif ASSAY in ('WGTS40X','WGS40X'):
  <%include file="resources/WGS40X.disclaimer.html"/>
% elif ASSAY == 'TAR':
  <%include file="resources/TAR.disclaimer.html"/>
% elif ASSAY == 'PWGS':
  <%include file="resources/PWGS.disclaimer.html"/>
% endif

${html_builder().section_cells_end()}

${html_builder().section_cells_begin("<h2>Report<br>Sign-offs</h2>",True)}



<table class="suppl" width="100%">
    <tr>
      <td width="33%">Report drafted by ${results.get(core_constants.AUTHOR)} on ${results.get('extract_date')}</td>
    </tr>
    <tr>
      <td width="33%">Report electronically signed out by ${results.get('clinical_geneticist_name')} (ABMS \#${results.get('clinical_geneticist_licence')}) on ${strftime("%Y/%m/%d")}</td>
    </tr>
  </table>

  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>

  ${html_builder().section_cells_end()}


  <hr class="big-line" style="width: 100%; ; page-break-after:always;"  >
  <hr class="header-big-line" style="width:100%; align:right">

  <h2>APPENDIX</h2>

  % if ASSAY in ('WGTS','TAR','WGS') and not FAILED:

    ${html_builder().section_cells_begin("<h3>Actionability</h3>",True, no_hr_after=True)}
      <%include file="resources/oncokb.definition.html"/>
    ${html_builder().section_cells_end()}

  % endif

  <hr class="big-white-line" >
  <br/>
  <br/>
  <hr class="big-white-line" >

  ${html_builder().section_cells_begin("<h3>Definitions</h3>",False)}

  % if not FAILED:
      % if ASSAY in ['WGTS', 'WGTS40X']:
        <%include file="resources/WGTS.FAIL.definitions.html"/>
        <%include file="resources/WGS.definitions.html"/>
        <%include file="resources/WTS.definitions.html"/>
      % elif ASSAY in ['WGS', 'WGS40X']:
        <%include file="resources/WGTS.FAIL.definitions.html"/>
        <%include file="resources/WGS.definitions.html"/>
      % elif ASSAY == 'TAR':
        <%include file="resources/TAR.FAIL.definitions.html"/>
        <%include file="resources/TAR.definitions.html"/>
      % elif ASSAY == 'PWGS':
        <%include file="resources/PWGS.definitions.html"/>
      % endif
  % else:
      % if ASSAY == 'WGTS' or ASSAY == "WGS" or ASSAY == 'WGTS40X' or ASSAY == 'WGS40X':
        <%include file="resources/WGTS.FAIL.definitions.html"/>
      % elif ASSAY == 'TAR':
        <%include file="resources/TAR.FAIL.definitions.html"/>
      % elif ASSAY == 'PWGS':
        <%include file="resources/PWGS.definitions.html"/>
      % endif
  % endif

  ${html_builder().section_cells_end()}
