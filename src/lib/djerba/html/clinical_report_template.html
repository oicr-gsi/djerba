<%
  from time import strftime
  import djerba.render.constants as constants
  from djerba.render.json_to_html import html_builder
%>

<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8" />
<%include file="header_style.html"/>
</head>
<body>
<div class="container-fluid main-container">
<div>
  <img src="${oicr_logo}" width="140" height="96" style="float:left" />
  <%include file="header.html"/>
</div>
<div class="fluid-row" id="header">
</div>
<%include file="body_style.html"/>

% if failed:
<div>
<h3 style="color:red;text-align:center;">QUALITY FAILURE REPORT</h3>
</div>
% endif

<!-- empty header to generate a separator -->
<div id="header2">
  <h3></h3>
</div>
<table width="100%">
  <tr><td><strong>Assay: </strong> ${patient_info.get(constants.ASSAY_NAME)}</td></tr>
</table>
<table width="100%">
% for row in html_builder().patient_table_rows_3_cols(patient_info):
      ${row}
% endfor
</table>
<table width="100%">
% for row in html_builder().patient_table_rows_2_cols(patient_info):
      ${row}
% endfor
</table>

<div style="height:36px"><h3 class="header1">Sample Information &amp; Quality</h3></div>
<table width="100%" style="font-size:14px">
% for row in html_builder(purity_failure).sample_information_and_quality_rows(sample_info_and_quality):
      ${row}
% endfor
</table>

<%include file="variants_table_style.html"/>
<div class="keep-together">
% if failed:
<div style="height:36px"><h3 class="header1">Summary of Quality Control Findings</h3></div>
% else:
<div style="height:36px"><h3 class="header1">Summary of Genomic Findings</h3></div>
% endif
## Omit summary of therapies for failed samples
% if not failed:
<%include file="genomic_therapies_template.html"/>
% endif
## ends keep-together
</div>
<br/>
% if failed:
<div style="border:3px; border-style:solid; border-color:#FF0000; padding: 1em;">
% else:
<div style="border:3px; border-style:solid; border-color:#000000; padding: 1em;">
% endif
${html_builder().markdown_to_html(genomic_summary)}
</div>
## Omit all genomic landscape and variant information for failed samples
% if not failed:
<%include file="genomic_details_template.html"/>
% endif
<div id="header2">
<h3></h3>
</div>
% if assay_type == constants.ASSAY_WGTS:
<%include file="description_wgts.html"/>
% elif assay_type == constants.ASSAY_WGS:
<%include file="description_wgs_only.html"/>
% else:
<% raise RuntimeError("Unknown assay type") %>
% endif
</div>
<br/>
<div style="border:3px; border-style:solid; border-color:#000000; padding: 1em;">
${html_builder().markdown_to_html(technical_notes)}
</div>
<%include file="definitions_1.html"/>
<p><strong>Coverage: </strong>Mean number of bases covering each sequenced base. Minimum coverage threshold is ${coverage_thresholds.get(constants.TUMOUR_MIN)}x for the tumour (with a target of ${coverage_thresholds.get(constants.TUMOUR_TARGET)}x); ${coverage_thresholds.get(constants.NORMAL_MIN)}x for the normal (with a target of ${coverage_thresholds.get(constants.NORMAL_TARGET)}x).</p>
<%include file="definitions_2.html"/>
<%
    if report_date:
        date = report_date
    else:
        date = strftime('%Y/%m/%d')
%>

<table width="100%">
  <tr>
    <td width="33%">Report drafted by ${author} on ${date}</td>
  </tr>
  <tr>
    <td width="33%"></td>
  </tr>
  <tr>
    <td width="33%">Report electronically signed out by Trevor Pugh, PhD, FACMG (ABMS #1027812) on yyyy/mm/dd</td>
  </tr>
</table>

</div>
</body>
</html>
