<%
  import djerba.render.constants as constants
  from djerba.render.json_to_html import html_builder
%>

  <hr class="header-big-line" style="width:100%; align:right; page-break-before:always;">
  <h2>Supplementary </h2>

  % if not failed:
    ${html_builder().section_cells_begin("<h3>Gene Information</h3>","supp")}

    % if len(gene_info) > 0:
          <table class="variants" width="100%" >
          ${html_builder().supplementary_gene_info_header()}
          <tbody>
          % for row in html_builder().supplementary_gene_info_rows(gene_info):
                ${row}
          % endfor
          </tbody>
          </table>
    % else:
          <p >No relevant oncogenes were detected in OncoKB.</p>

    % endif
    <p><strong>Genes tested</strong>: Although whole genome sequencing encompasses all genes in a specimen, this report is restricted to cancer genes as defined by OncoKB as of the date this report.</p>

    ${html_builder().section_cells_end()}

    ${html_builder().section_cells_begin("<h3>OncoKB Definitions</h3>","supp")}
      <%include file="templates_for_supp/definitions_oncokb.html"/>
    ${html_builder().section_cells_end()}

  % endif

  ${html_builder().section_cells_begin("<h3>Definitions</h3>","supp")}

    <%include file="templates_for_supp/definitions_metrics.html"/>
    % if not failed:
      <%include file="templates_for_supp/definitions_tests.html"/>
    % endif

  ${html_builder().section_cells_end()}

  ${html_builder().section_cells_begin("<h3>Assay description</h3>","supp")}

    % if assay_type == constants.ASSAY_WGTS:
      <p> This assay combines two comprehensive next generation sequencing assays: a DNA-based whole genome sequencing (WGS) assay and an RNA-based whole transcriptome sequencing (WTS) assay.</p>
      <%include file="templates_for_supp/description_wgs.html"/>
      <%include file="templates_for_supp/description_wts.html"/>
    % elif assay_type == constants.ASSAY_WGS:
      <p>This assay is a comprehensive next generation sequencing assay, specifically DNA-based whole genome sequencing (WGS). </p>
      <%include file="templates_for_supp/description_wgs.html"/>
    % else:
      <% raise RuntimeError("Unknown assay type") %>
    % endif

    <p>Assay results were collated into the report document by <a href=${versions.get(constants.DJERBA_LINK)}>Djerba</a> (${versions.get(constants.DJERBA_VERSION)}) using pipeline v.${versions.get(constants.DJERBA_PIPELINE_VERSION)}.</p>

  ${html_builder().section_cells_end()}

  ## Slightly hacky method to omit technical notes with null content
  % if not technical_notes.strip() == 'No technical notes supplied.':
    ${html_builder().section_cells_begin("<h3>Technical Notes</h3>","supp")}
    ${html_builder().markdown_to_html(technical_notes)}
    ${html_builder().section_cells_end()}
  % endif

  ${html_builder().section_cells_begin("<h3>Disclaimer</h3>","supp")}
  <%include file="templates_for_supp/disclaimer.html"/>

  ${html_builder().section_cells_end()}
